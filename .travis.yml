jobs:
  include:
    # - stage: danger
    #   language: ruby
    #   rvm: 2.5.1
    #   install: bundle install
    #   script: bundle exec danger --fail-on-errors=true --remove-previous-comments
    #   if: type = pull_request
    - stage: test
      language: rust
      rust: stable
      cache: cargo
      script:
        - cargo build --verbose --all
        - cargo test --verbose --all
    - language: rust
      rust: beta
      cache: cargo
      script:
        - cargo build --verbose --all
        - cargo test --verbose --all
      if: type = pull_request
    - language: rust
      rust: nightly
      cache: cargo
      script:
        - cargo build --verbose --all
        - cargo test --verbose --all
      if: type = pull_request
    # - stage: docs
    #   language: rust
    #   rust: stable
    #   cache: cargo
    #   before_script:
    #     - export PATH=$HOME/.cargo/bin:$PATH
    #     - cargo install cargo-update || echo "cargo-update already installed"
    #     - cargo install cargo-travis || echo "cargo-travis already installed"
    #     - cargo install-update -a # update outdated cached binaries
    #   script:
    #     - |
    #        cargo build &&
    #        cargo doc
    #   after_success:
    #     - cargo doc-upload
    #   if: type = push AND branch = master
  allow_failures:
    - rust: nightly
  fast_finish: true

stages:
  # - danger
  - test
  # - docs

notifications:
  email: false
